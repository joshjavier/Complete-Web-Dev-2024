<%- include('partials/header.ejs') %>

<h1><%= post.title %></h1>

<p>by <%= post.author %></p>

<a href="<%= `/post/${post.slug ?? post.id}/edit` %>">Edit post</a>
<button data-js-hook="delete-btn">Delete post</button>

<p><%= post.body %></p>

<script>
  const deleteBtn = document.querySelector('[data-js-hook="delete-btn"]')

  deleteBtn.addEventListener('click', () => {
    if (confirm('Are you sure you want to delete this post?')) {
      deletePost()
      redirectToHome()
    }
  })

  function deletePost() {
    fetch(location, { method: 'DELETE' }).then(response => {
      if (response.status === 204) {
        console.log('This post has been deleted.')
      }
    })
  }

  function redirectToHome(delay) {
    alert(`This post has been deleted. Press OK to redirect to home.`)
    location.href = '/'
    // setTimeout(() => {
    //   location.href = '/'
    // }, delay * 1000)
  }
</script>

<%- include('partials/footer.ejs') %>
